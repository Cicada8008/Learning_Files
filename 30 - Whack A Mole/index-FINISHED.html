<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Whack A Mole!</title>
  <link href='https://fonts.googleapis.com/css?family=Amatic+SC:400,700' rel='stylesheet' type='text/css'>
  <link rel="icon" href="https://fav.farm/âœ…" />
  <style>
    html { box-sizing: border-box; font-size: 10px; background: #f2ff00; }
    *, *:before, *:after { box-sizing: inherit; }
    body { padding: 0; margin: 0; font-family: 'Amatic SC', cursive; }
    h1 { text-align: center; font-size: 10rem; line-height: 1; margin-bottom: 0; }
    .score { background: rgba(255,255,255,0.2); padding: 0 3rem; line-height: 1; border-radius: 1rem; }
    .game { width: 600px; height: 400px; display: flex; flex-wrap: wrap; margin: 0 auto; }
    .hole { flex: 1 0 33.33%; overflow: hidden; position: relative; }
    .hole:after { display: block; background: url(dirt.svg) bottom center no-repeat; background-size: contain; content: ''; width: 100%; height:70px; position: absolute; z-index: 2; bottom: -30px; }
    .mole { background: url('cafe.jpg') bottom center no-repeat; background-size: 60%; position: absolute; top: 100%; width: 100%; height: 100%; transition:all 0.4s; }
    .hole.up .mole { top: 0; }
    button { display: block; margin: 20px auto; padding: 12px 24px; font-weight: bold; font-size: 18px; border: none; border-radius: 25px; background-color: #4CAF50; color: white; cursor: pointer; transition: background 0.3s; }
    button:hover { background-color: #45a049; }

    /* Modal CSS */
    .modal-backdrop { position: fixed; inset: 0; display: none; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 9999; }
    .modal { background: white; padding: 25px 35px; border-radius: 15px; text-align: center; font-family: 'Amatic SC', cursive; width: 450px; box-shadow: 0 8px 25px rgba(0,0,0,0.25); }
    .modal h2 { font-size: 4rem; margin-bottom: 15px; }
    .difficulty-options { display: flex; justify-content: space-between; gap: 12px; margin-bottom: 20px; }
    .difficulty-options button {
      width: 140px; height: 55px; font-size: 3rem; border-radius: 12px; border: 0; cursor: pointer;
      background: #ffeb3b; display: flex; align-items: center; justify-content: center; text-align: center; transition: all 0.2s ease;
    }
    .difficulty-options button.selected { background: #fdd835; outline: 4px solid #ff6f00; }
    .modal button { font-size: 3rem; padding: 10px 25px; border-radius: 12px; border: 0; background: #4CAF50; color: white; cursor: pointer; }
    .modal button.cancel { background: #f44336; } /* Cancel button color red */
    .end-actions { display: flex; gap: 12px; justify-content: center; margin-top: 12px; }
  </style>
</head>
<body>

  <h1>Whack-a-mole! <span class="score">0</span></h1>
  <button id="startBtn">Start!</button>

  <div class="game">
    <div class="hole hole1"><div class="mole"></div></div>
    <div class="hole hole2"><div class="mole"></div></div>
    <div class="hole hole3"><div class="mole"></div></div>
    <div class="hole hole4"><div class="mole"></div></div>
    <div class="hole hole5"><div class="mole"></div></div>
    <div class="hole hole6"><div class="mole"></div></div>
  </div>

  <!-- Difficulty Modal -->
  <div id="difficultyModal" class="modal-backdrop">
    <div class="modal">
      <h2>Select Difficulty</h2>
      <div class="difficulty-options">
        <button data-diff="easy">Easy</button>
        <button data-diff="medium">Medium</button>
        <button data-diff="hard">Hard</button>
      </div>
      <div class="end-actions">
        <button id="startGameBtn">Play</button>
        <button id="cancelDifficultyBtn" class="cancel">Cancel</button>
      </div>
    </div>
  </div>

  <!-- End Game Modal -->
  <div id="endModal" class="modal-backdrop">
    <div class="modal">
      <h2>Time's Up!</h2>
      <p style="font-size:3rem;">Score: <span id="finalScore">0</span></p>
      <div class="end-actions">
        <button id="playAgainBtn">Play Again</button>
      </div>
    </div>
  </div>

  <!-- Confirm Restart Modal -->
  <div id="confirmModal" class="modal-backdrop">
    <div class="modal">
      <h2>Game in progress</h2>
      <p>Do you want to restart?</p>
      <div class="end-actions">
        <button id="restartBtn">Restart</button>
        <button id="cancelBtn" class="cancel">Cancel</button>
      </div>
    </div>
  </div>

<script>
  // Elements
  const holes = document.querySelectorAll('.hole');
  const scoreBoard = document.querySelector('.score');
  const moles = document.querySelectorAll('.mole');
  const startBtn = document.getElementById('startBtn');
  const difficultyModal = document.getElementById('difficultyModal');
  const startGameBtn = document.getElementById('startGameBtn');
  const cancelDifficultyBtn = document.getElementById('cancelDifficultyBtn');
  const diffButtons = document.querySelectorAll('[data-diff]');
  const endModal = document.getElementById('endModal');
  const finalScoreEl = document.getElementById('finalScore');
  const playAgainBtn = document.getElementById('playAgainBtn');
  const confirmModal = document.getElementById('confirmModal');
  const restartBtn = document.getElementById('restartBtn');
  const cancelBtn = document.getElementById('cancelBtn');

  // State
  let score = 0, lastHole, timeUp = false, currentDifficulty = "medium";
  let timers = [], gameRunning = false;
  const speeds = { easy:{min:600,max:1200}, medium:{min:300,max:700}, hard:{min:120,max:400} };

  function randomTime(min,max){ return Math.round(Math.random()*(max-min)+min); }
  function randomHole(holes){ const idx=Math.floor(Math.random()*holes.length); const hole=holes[idx]; if(hole===lastHole)return randomHole(holes); lastHole=hole; return hole; }
  function clearTimers(){ timers.forEach(t=>clearTimeout(t)); timers=[]; }
  function resetMoles(){ holes.forEach(h=>h.classList.remove('up')); lastHole=null; }

  function peep(){
    const {min,max}=speeds[currentDifficulty];
    const time=randomTime(min,max);
    const hole=randomHole(holes);
    hole.classList.add('up');
    const t=setTimeout(()=>{ hole.classList.remove('up'); if(!timeUp) peep(); }, time);
    timers.push(t);
  }

  function startGame(){
    clearTimers(); resetMoles();
    score=0; timeUp=false; scoreBoard.textContent=score; gameRunning=true;
    peep();
    const gameTimer=setTimeout(()=>endGame(),10000);
    timers.push(gameTimer);
  }

  function endGame(){
    timeUp=true; gameRunning=false; clearTimers(); resetMoles();
    finalScoreEl.textContent=score;
    endModal.style.display='flex';
  }

  moles.forEach(m=>m.addEventListener('click',e=>{
    if(!e.isTrusted) return;
    score++; e.target.parentNode.classList.remove('up');
    scoreBoard.textContent=score;
  }));

  diffButtons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      currentDifficulty=btn.dataset.diff;
      diffButtons.forEach(b=>b.classList.remove('selected'));
      btn.classList.add('selected');
    });
  });

  function openDifficultyModal(){
    diffButtons.forEach(b=>b.classList.toggle('selected',b.dataset.diff===currentDifficulty));
    difficultyModal.style.display='flex';
  }
  function closeDifficultyModal(){ difficultyModal.style.display='none'; }

  startBtn.addEventListener('click', ()=>{
    if(gameRunning){
      confirmModal.style.display='flex';
    } else openDifficultyModal();
  });

  startGameBtn.addEventListener('click', ()=>{
    closeDifficultyModal(); startGame();
  });

  cancelDifficultyBtn.addEventListener('click', ()=>{
    closeDifficultyModal();
  });

  playAgainBtn.addEventListener('click', ()=>{
    endModal.style.display='none'; openDifficultyModal();
  });

  restartBtn.addEventListener('click', ()=>{
    confirmModal.style.display='none'; startGame();
  });
  cancelBtn.addEventListener('click', ()=>{
    confirmModal.style.display='none'; openDifficultyModal();
  });

  document.addEventListener('keydown',e=>{
    if(e.key==='Escape'){
      [difficultyModal,endModal,confirmModal].forEach(m=>{ if(m.style.display==='flex') m.style.display='none'; });
    }
  });
</script>

</body>
</html>
